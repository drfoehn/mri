<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ _('Minimum Retesting Intervals') }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://unpkg.com/htmx.org@1.9.2"></script>
    <style>
        .reference-link {
            color: #0d6efd;
            text-decoration: none;
            font-weight: 500;
        }
        .reference-link:hover {
            color: #0a58ca;
            text-decoration: underline;
        }
        .reference-link sup {
            font-size: 0.7em;
            color: #6c757d;
        }
        /* Smooth scrolling for anchor links */
        html {
            scroll-behavior: smooth;
        }
        /* Highlight target reference when linked to */
        tr[id]:target {
            background-color: #fff3cd !important;
            border-left: 4px solid #ffc107;
        }
    </style>
</head>
<body>
<div class="container py-4">
    <!-- Navigation Bar -->
    <div class="row mb-3">
        <div class="col-12">
            <nav class="navbar navbar-expand-lg navbar-light bg-light rounded">
                <div class="container-fluid">
                    <div class="navbar-nav me-auto">
                        <a class="nav-link" href="{{ url_for('index') }}">
                            <i class="bi bi-house"></i> {{ _('Search') }}
                        </a>
                        <a class="nav-link" href="{{ url_for('references') }}">
                            <i class="bi bi-book"></i> {{ _('References') }}
                        </a>
                        <a class="nav-link" href="{{ url_for('evidence_levels') }}">
                            <i class="bi bi-clipboard-check"></i> {{ _('Evidence Levels') }}
                        </a>
                        <a class="nav-link" href="{{ url_for('abbreviations') }}">
                            <i class="bi bi-list-ul"></i> {{ _('Abbreviations') }}
                        </a>
                        <a class="nav-link" href="https://www.rcpath.org/static/253e8950-3721-4aa2-8ddd4bd94f73040e/g147_national-minimum_retesting_intervals_in_pathology.pdf" target="_blank">
                            <i class="bi bi-file-pdf"></i> {{ _('Original PDF') }}
                        </a>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="languageMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                            {{ _('Language') }}
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="languageMenuButton">
                            <li><a class="dropdown-item" href="{{ url_for('set_language', language='en') }}">English</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('set_language', language='de') }}">Deutsch</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </div>
    
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="text-center">
                <!-- Organization Logos -->
                <div class="d-flex justify-content-center align-items-center mb-3 flex-wrap gap-3">
                    <img src="{{ url_for('static', filename='images/IBMS_logo.jpg') }}" alt="IBMS Logo" class="img-fluid" style="max-height: 60px;">
                    <img src="{{ url_for('static', filename='images/Royal-college-of-Pathologists-Logo.jpg') }}" alt="Royal College of Pathologists Logo" class="img-fluid" style="max-height: 60px;">
                    <img src="{{ url_for('static', filename='images/assoc_logo.svg') }}" alt="Association Logo" class="img-fluid" style="max-height: 60px;">
                </div>
                
                <!-- Main Title -->
                <h1 class="mb-2">{{ _('National minimum retesting intervals in pathology') }}</h1>
                <h5 class="text-muted mb-3">{{ _('Version: March 2021') }}</h5>
                
                <!-- Authors -->
                <div class="mb-3">
                    <p class="mb-1"><strong>{{ _('Authors:') }}</strong></p>
                    <p class="mb-0">{{ _('Dr Tim Lang, County Durham and Darlington NHS Foundation Trust') }}</p>
                    <p class="mb-0">{{ _('Dr Bernie Croal, Aberdeen Royal Infirmary, NHS Grampian') }}</p>
                </div>
                
                <!-- Application Info -->
                <div class="d-flex justify-content-center align-items-center gap-3">
                    <span class="text-muted">{{ _('Application by Janne Cadamuro with the') }}</span>
                    <a href="https://labmedalliance.com" target="_blank">
                        <img src="{{ url_for('static', filename='images/lma logo.jpg') }}" alt="LabMed Alliance Logo" class="img-fluid" style="max-height: 80px;">
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <form method="post" class="row g-3 mb-4">
        <div class="col-12 col-md-3">
            <label for="section" class="form-label">{{ _('Section') }}</label>
            <select class="form-select" id="section" name="section"
                    hx-post="/get_chapters" hx-trigger="change" hx-target="#chapter" hx-swap="outerHTML"
                    hx-include="[name='section']">
                <option value="">{{ _('Please select...') }}</option>
                {% for section in sections %}
                    <option value="{{ section }}" {% if section == selected_section %}selected{% endif %}>{{ section }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-12 col-md-3">
            <label for="chapter" class="form-label">{{ _('Chapter') }}</label>
            <select class="form-select" id="chapter" name="chapter"
                    {% if not selected_section %}disabled{% endif %}
                    hx-post="/get_subsections" hx-trigger="change" hx-target="#subsection" hx-swap="outerHTML"
                    hx-include="[name='chapter']">
                <option value="">{{ _('Please select Section first') }}</option>
                {% if selected_section %}
                    {% for chapter in chapters %}
                        <option value="{{ chapter }}" {% if chapter == selected_chapter %}selected{% endif %}>{{ chapter }}</option>
                    {% endfor %}
                {% endif %}
            </select>
        </div>
        <div class="col-12 col-md-3">
            <label for="subsection" class="form-label">{{ _('Subsection') }}</label>
            <select class="form-select" id="subsection" name="subsection" {% if not selected_chapter %}disabled{% endif %}>
                <option value="">{{ _('Please select Chapter first') }}</option>
                {% if selected_chapter %}
                    {% for subsection in subsections %}
                        <option value="{{ subsection }}" {% if subsection == selected_subsection %}selected{% endif %}>{{ subsection }}</option>
                    {% endfor %}
                {% endif %}
            </select>
        </div>
        <div class="col-12 col-md-3">
            <label for="search_text" class="form-label">{{ _('Clinical Situation / Test') }}</label>
            <input type="text" class="form-control" id="search_text" name="search_text" value="{{ search_text }}" placeholder="{{ _('Search term...') }}">
        </div>
        <div class="col-12">
            <button type="submit" class="btn btn-primary w-100">{{ _('Search') }}</button>
        </div>
    </form>

    {% if results %}
        <div class="table-responsive">
            <table class="table table-striped table-bordered align-middle">
                <thead class="table-light">
                <tr>
                    <th>{{ _('Section') }}</th>
                    <th>{{ _('Chapter') }}</th>
                    <th>{{ _('Subsection') }}</th>
                    <th>{{ _('Ref') }}</th>
                    <th>{{ _('Clinical Situation / Test') }}</th>
                    <th>{{ _('Recommendation') }}</th>
                    <th>{{ _('Source') }}</th>
                    <th>{{ _('Level of Evidence') }}</th>
                </tr>
                </thead>
                <tbody>
                {% for entry in results %}
                    <tr>
                        <td>{{ entry.section }}</td>
                        <td>{{ entry.chapter }}</td>
                        <td>{{ entry.subsection or '' }}</td>
                        <td>{{ entry.ref or '' }}</td>
                        <td>{{ entry.clinical_situation | safe }}</td>
                        <td>{{ entry.recommendation }}</td>
                        <td>{{ entry.source or '' }}</td>
                        <td>{{ entry.level_of_evidence or '' }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    {% elif request.method == 'POST' and not results %}
        <div class="alert alert-warning">{{ _('No results found.') }}</div>
    {% endif %}
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>